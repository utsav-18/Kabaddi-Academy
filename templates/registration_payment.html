{% extends "base.html" %}

{% block title %}Register & Pay - KVS Kabaddi Academy{% endblock %}

{% block content %}

<div class="registration-container">

    <h1 class="form-title">Register & Pay</h1>

    <form id="regForm" class="registration-form">
        <label>
            Name:
            <input type="text" name="name" class="form-input" required>
        </label>

        <label>
            Father Name:
            <input type="text" name="father_name" class="form-input">
        </label>

        <label>
            DOB:
            <input type="date" name="dob" class="form-input">
        </label>

        <label>
            Class:
            <input type="text" name="class" class="form-input">
        </label>

        <label>
            Academy Join:
            <input type="text" name="academy_join" class="form-input">
        </label>

        <label>
            Mobile No.:
            <input type="text" name="contact" class="form-input" required>
        </label>

        <button type="button" id="payBtn" class="btn-primary">
            Pay ₹1 & Register
        </button>
    </form>

    <p class="test-mode-info">
        <strong>Test Mode —</strong> Use card <code>4111 1111 1111 1111</code>, any future expiry, CVV <code>123</code>
    </p>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.getElementById("payBtn").addEventListener("click", function() {
    const form = document.getElementById("regForm");
    const formData = new FormData(form);
    let data = {};
    formData.forEach((v, k) => data[k] = v);

    const options = {
        key: "rzp_test_XbnqrIC7Y9cJV0",
        amount: 100,
        currency: "INR",
        name: "KVS Kabaddi Academy",
        description: "Admission Fee",
        prefill: {
            name: data.name,
            contact: data.contact
        },
        theme: { color: "#FACC15" },
        handler: function (response) {
            fetch("/registration", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    ...data,
                    payment_id: response.razorpay_payment_id
                })
            })
            .then(r => r.json())
            .then(res => {
                alert("Registration & Payment Successful!");
                window.location.href = "/dashboard";
            });
        }
    };
    const rzp = new Razorpay(options);
    rzp.open();
});
</script>
{% endblock %}
